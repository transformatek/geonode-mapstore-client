(self.webpackChunkgeonode_mapstore_client=self.webpackChunkgeonode_mapstore_client||[]).push([[8067],{67007:(e,t,r)=>{"use strict";r.d(t,{ZP:()=>j});var n=r(8575),i=r(1469),a=r.n(i),o=r(84596),u=r.n(o),l=r(27361),s=r.n(l),c=r(27418),f=r.n(c),p=r(5055),d=r.n(p),m=r(75875),g=r.n(m),y=r(37275),b=r(90183);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){O(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var x={},S=function(e){var t=(a()(e)&&e||e.split(","))[0],r=n.parse(t,!0);return n.format(f()({},r,{search:null},{query:f()({service:"WMS",version:"1.3.0",request:"GetCapabilities"},r.query)}))},w=function(e){var t=e&&e.Title,r=e.LogoURL&&h(h({},s()(e,"LogoURL.$")||{}),{},{format:s()(e,"LogoURL.Format")}),n=s()(e,'OnlineResource.$["xlink:href"]');return{title:t,logo:r,imageUrl:s()(e,'LogoURL.OnlineResource.$["xlink:href"]'),link:n}},C=function e(t){return t.Layer?(a()(t.Layer)&&t.Layer||[t.Layer]).reduce((function(t,r){return t.concat(e(r)).concat(r.Layer&&r.Name?[r]:[])}),[]):t.Name&&[t]||[]},L=function(e){return e.Request&&e.Request.GetMap&&e.Request.GetMap.DCPType&&e.Request.GetMap.DCPType.HTTP&&e.Request.GetMap.DCPType.HTTP.Get&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource&&e.Request.GetMap.DCPType.HTTP.Get.OnlineResource.$||void 0},R=function(){var e,t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0,o=arguments.length>2?arguments[2]:void 0,u=arguments.length>3?arguments[3]:void 0,l=(n.WMS_Capabilities||n.WMT_MS_Capabilities||{}).Capability,s=(n.WMS_Capabilities||n.WMT_MS_Capabilities||{}).Service,c=L(l),p=l.Layer&&(null===(e=l.Layer.SRS||l.Layer.CRS)||void 0===e?void 0:e.map((function(e){return e.toUpperCase()})))||[],d=l.Layer&&l.Layer.Attribution&&w(l.Layer.Attribution),m=l.Request&&l.Request.GetMap&&l.Request.GetMap.Format||[],g=C(l),y=a()(g)?g:[g],b=y.filter((function(e){return!u||-1!==e.Name.toLowerCase().indexOf(u.toLowerCase())||e.Title&&-1!==e.Title.toLowerCase().indexOf(u.toLowerCase())||e.Abstract&&-1!==e.Abstract.toLowerCase().indexOf(u.toLowerCase())}));return{numberOfRecordsMatched:b.length,numberOfRecordsReturned:Math.min(o,b.length),nextRecord:i+Math.min(o,b.length)+1,service:s,layerOptions:{version:(null===(t=n.WMS_Capabilities||n.WMT_MS_Capabilities)||void 0===t||null===(r=t.$)||void 0===r?void 0:r.version)||"1.3.0"},records:b.filter((function(e,t){return t>=i-1&&t<i-1+o})).map((function(e){return f()({},e,{formats:m,onlineResource:c,SRS:p,credits:e.Attribution?w(e.Attribution):d})}))}},M=function(e,t,r,n){var i=x[e];return i&&(new Date).getTime()<i.timestamp+1e3*((0,y.u8)("cacheExpire")||60)?new Promise((function(e){e(R(i.data,t,r,n))})):g().get(S(e)).then((function(i){var a;return d().parseString(i.data,{explicitArray:!1},(function(e,t){a=t})),x[e]={timestamp:(new Date).getTime(),data:a},R(a,t,r,n)}))};const j={flatLayers:C,parseUrl:S,getDimensions:function(e){return u()(e.Dimension||e.dimension||[]).map((function(t,r){var n=e.Extent&&u()(e.Extent)[r]||e.extent&&u()(e.extent)[r];return{name:t.$.name,units:t.$.units,unitSymbol:t.$.unitSymbol,default:t.$.default||n&&n.$.default,values:t._&&t.split(",")||n&&n._&&n.split(",")}}))},getCapabilities:function(e,t){var i=n.parse(e,!0),a=n.format(f()({},i,{query:f()({service:"WMS",version:"1.1.1",request:"GetCapabilities"},i.query)}));return new Promise((function(e){Promise.all([r.e(9942),r.e(7260)]).then(function(){var n=r(67260).unmarshaller;e(g().get(S(a)).then((function(e){var r;if(t)return d().parseString(e.data,{explicitArray:!1},(function(e,t){r=t})),r;var i=n.unmarshalString(e.data);return i&&i.value})))}.bind(null,r)).catch(r.oe)}))},describeLayer:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.parse(e,!0),o=n.format(f()({},a,{query:f()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},a.query,i.query||{})}));return new Promise((function(e){Promise.all([r.e(9942),r.e(7260)]).then(function(){var t=r(67260).unmarshaller;e(g().get(S(o)).then((function(e){var r=t.unmarshalString(e.data);return r&&r.value&&r.value.layerDescription&&r.value.layerDescription[0]})))}.bind(null,r)).catch(r.oe)}))},getRecords:M,describeLayers:function(e,t){var r=n.parse(e,!0),i=n.format(f()({},r,{query:f()({service:"WMS",version:"1.1.1",layers:t,request:"DescribeLayer"},r.query)}));return g().get(S(i)).then((function(e){var t;return d().parseString(e.data,{explicitArray:!1},(function(e,r){t=r&&r.WMS_DescribeLayerResponse&&r.WMS_DescribeLayerResponse.LayerDescription})),(t=Array.isArray(t)?t:[t]).map((function(e){return h(h({},e&&e.$||{}),{},{layerName:e&&e.$&&e.$.name,query:h({},e&&e.query&&e.query.$||{})})}))}))},textSearch:function(e,t,r,n){return M(e,t,r,n)},parseLayerCapabilities:function e(t,r,n){return u()(n||s()(t,"capability.layer.layer")).reduce((function(n,i){return n||(!i.name&&i.layer?e(t,r,u()(i.layer)):2===r.name.split(":").length&&i.name&&2===i.name.split(":").length?r.name===i.name&&i:i.name&&2===i.name.split(":").length?r.name===i.name.split(":")[1]&&i:2===r.name.split(":").length?r.name.split(":")[1]===i.name&&i:r.name===i.name&&i)}),null)},getBBox:function(e,t){for(var r=e,n=r.EX_GeographicBoundingBox||r.exGeographicBoundingBox||(0,b.getWMSBoundingBox)(r.BoundingBox)||r.LatLonBoundingBox&&r.LatLonBoundingBox.$||r.latLonBoundingBox;!n&&r.Layer&&r.Layer.length;)n=(r=r.Layer[0]).EX_GeographicBoundingBox||r.exGeographicBoundingBox||(0,b.getWMSBoundingBox)(r.BoundingBox)||r.LatLonBoundingBox&&r.LatLonBoundingBox.$||r.latLonBoundingBox;n||(n={westBoundLongitude:-180,southBoundLatitude:-90,eastBoundLongitude:180,northBoundLatitude:90});var i={extent:[n.westBoundLongitude||n.minx,n.southBoundLatitude||n.miny,n.eastBoundLongitude||n.maxx,n.northBoundLatitude||n.maxy],crs:"EPSG:4326"};return t?{crs:i.crs,bounds:{minx:i.extent[0],miny:i.extent[1],maxx:i.extent[2],maxy:i.extent[3]}}:i},reset:function(){Object.keys(x).forEach((function(e){delete x[e]}))}}},7472:(e,t,r)=>{"use strict";r.d(t,{Z:()=>L});var n=r(27418),i=r.n(n),a=r(45697),o=r.n(a),u=r(5053),l=r.n(u),s=r(85294),c=r.n(s),f=r(72986),p=r.n(f),d=r(5346);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach((function(t){w(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?x(e):t}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function w(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var C=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(u,e);var t,r,n,a,o=(n=u,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=S(n);if(a){var r=S(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return O(this,e)});function u(){var e;b(this,u);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return w(x(e=o.call.apply(o,[this].concat(r))),"renderLoading",(function(){return e.props.maskLoading?l().createElement("div",{style:{width:"100%",height:"100%",position:"absolute",overflow:"visible",margin:"auto",verticalAlign:"center",left:"0",background:"rgba(255, 255, 255, 0.5)",zIndex:2}},l().createElement("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -40%)"}},l().createElement(d.Z,{msgId:"loading"}),l().createElement(p(),{spinnerName:"circle",noFadeIn:!0,overrideSpinnerClassName:"spinner"}))):null})),w(x(e),"renderRole",(function(t){return l().Children.toArray(e.props.children).filter((function(e){return e.props.role===t}))})),w(x(e),"hasRole",(function(t){return l().Children.toArray(e.props.children).filter((function(e){return e.props.role===t})).length>0})),w(x(e),"onClickOut",(function(t){e.props.onClickOut&&e.mask===t.target&&e.props.onClickOut(t)})),e}return t=u,(r=[{key:"render",value:function(){var e=this,t=l().createElement("div",{id:this.props.id,style:y({zIndex:3},this.props.style),className:"".concat(this.props.draggable?"modal-dialog-draggable":""," ").concat(this.props.className," modal-dialog-container")},l().createElement("div",{className:this.props.headerClassName+" draggable-header"},this.renderRole("header")),l().createElement("div",{className:this.props.bodyClassName},this.renderLoading(),this.renderRole("body")),this.hasRole("footer")?l().createElement("div",{className:this.props.footerClassName},this.renderRole("footer")):l().createElement("span",null)),r=this.props.draggable?l().createElement(c(),{defaultPosition:this.props.start,bounds:this.props.bounds,handle:".draggable-header, .draggable-header *"},t):t,n=i()({},this.props.style.display?{display:this.props.style.display}:{},this.props.backgroundStyle);return this.props.modal?l().createElement("div",{ref:function(t){e.mask=t},onClick:this.onClickOut,style:n,className:"fade in modal "+this.props.containerClassName,role:"dialog"},r):r}}])&&v(t.prototype,r),u}(l().Component);w(C,"propTypes",{id:o().string.isRequired,style:o().object,backgroundStyle:o().object,className:o().string,maskLoading:o().bool,containerClassName:o().string,headerClassName:o().string,bodyClassName:o().string,footerClassName:o().string,onClickOut:o().func,modal:o().bool,start:o().object,draggable:o().bool,bounds:o().oneOfType([o().string,o().object])}),w(C,"defaultProps",{style:{},backgroundStyle:{background:"rgba(0,0,0,.5)"},start:{x:0,y:150},className:"modal-dialog modal-content",maskLoading:!1,containerClassName:"",headerClassName:"modal-header",bodyClassName:"modal-body",footerClassName:"modal-footer",modal:!1,draggable:!0,bounds:"parent"});const L=C},76712:(e,t,r)=>{"use strict";r.d(t,{n0:()=>F,tW:()=>Z,FJ:()=>H,ll:()=>X,eL:()=>J,AD:()=>K,QQ:()=>V,T6:()=>ee});var n=r(27418),i=r.n(n),a=r(91175),o=r.n(a),u=r(1469),l=r.n(u),s=r(47037),c=r.n(s),f=r(84596),p=r.n(f),d=r(13218),m=r.n(d),g=r(89734),y=r.n(g),b=r(44908),v=r.n(b),h=r(64721),O=r.n(h),x=r(27361),S=r.n(x),w=r(14293),C=r.n(w),L=r(41609),R=r.n(L),M=r(8575),j=r(90183),B=r(37275),P=r(24262),T=r(86638),W=r(7294),E=(r(33044),r(67007)),G=r(88798);function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function q(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?k(Object(r),!0).forEach((function(t){D(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function D(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _=function(e){return e&&e.replace(/\/csw$/,"/")},A=function(e){return m()(e)&&e._||e},I=function(e,t){return e.filter((function(r){return W.C2(t,r,e,t,null)}))},N=function(e){var t=Array.isArray(e.references)?e.references:[e.references];return o()([].filter.call(t,(function(t){return"WWW:LINK-1.0-http--image-thumbnail"===t.scheme||"thumbnail"===t.scheme||"WWW:DOWNLOAD-1.0-http--download"===t.scheme&&-1!==(t.value||"").indexOf("".concat(e.identifier||"","-thumb"))||"WWW:DOWNLOAD-REST_MAP"===t.scheme&&-1!==(t.value||"").indexOf("".concat(e.identifier||"","-thumb"))})))},U={csw:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e;return n&&n.records?n.records.map((function(e){var n,a,u,s=e.dc;if(s&&s.URI){var f=l()(s.URI)?s.URI:s.URI&&[s.URI]||[],d=o()([].filter.call(f,(function(e){return"thumbnail"===e.name})))||o()([].filter.call(f,(function(e){var t;return!e.name&&(null===(t=e.protocol)||void 0===t?void 0:t.indexOf("image/"))>-1})));n=d?d.value:null,a=o()([].filter.call(f,(function(e){return e.protocol&&(e.protocol.match(/^OGC:WMS-(.*)-http-get-map/g)||e.protocol.match(/^OGC:WMS/g))})))}if(!a&&s&&s.references&&s.references.length){var m=Array.isArray(s.references)?s.references:[s.references];if(a=o()([].filter.call(m,(function(e){return e.scheme&&(e.scheme.match(/^OGC:WMS-(.*)-http-get-map/g)||"OGC:WMS"===e.scheme)})))){var g=M.parse(a.value,!0),b=g.query&&g.query.layers||s.alternative;a=i()({},a,{name:b})}}if(!a&&s&&s.references&&s.references.length){var h=Array.isArray(s.references)?s.references:[s.references];if(u=o()([].filter.call(h,(function(e){return e.scheme&&"WWW:DOWNLOAD-REST_MAP"===e.scheme})))){var x=s.alternative;u=i()({},u,{name:x})}}if(!n&&s&&s.references){var S=N(s);S&&(n=S.value)}var w=[];if(s&&s.references&&(Array.isArray(s.references)?s.references:[s.references]).filter((function(e){return e.scheme.indexOf("http-get-capabilities")>-1})).forEach((function(e){var r=0===e.value.indexOf("http")?e.value:(t&&t.catalogURL||"")+"/"+e.value;w.push({type:e.scheme,url:r})})),a&&a.name){0===a.value.indexOf("http")||i()({},a,{value:(t&&t.catalogURL||"")+"/"+a.value});var C={type:a.protocol||a.scheme,url:a.value,SRS:[],params:{name:a.name}};w.push(C)}if(u&&u.name){var L={type:"arcgis",url:u.value,SRS:[],params:{name:u.name}};w.push(L)}n&&(0===n.indexOf("http")||(n=(_(t&&t.url)||"")+n));var R={boundingBox:e.boundingBox&&e.boundingBox.extent&&p()(e.boundingBox.extent.join(","))};if(s&&(R=q(q({},R),y()(Object.keys(s)).reduce((function(e,t){return q(q({},e),{},D({},t,v()(p()(s[t]))))}),{}))),s&&s.URI&&p()(s.URI)&&p()(s.URI).length&&(R=q(q({},R),{},{uri:["<ul>"+p()(s.URI).map((function(e){return'<li><a target="_blank" href="'.concat(e.value,'">').concat(e.name,"</a></li>")})).join("")+"</ul>"]})),s&&s.subject&&p()(s.subject)&&p()(s.subject).length&&(R=q(q({},R),{},{subject:["<ul>"+p()(s.subject).map((function(e){return"<li>".concat(e,"</li>")})).join("")+"</ul>"]})),w&&p()(w).length?R=q(q({},R),{},{references:["<ul>"+p()(w).map((function(e){return'<li><a target="_blank" href="'.concat(e.url,'">').concat(e.params&&e.params.name||e.url,"</a></li>")})).join("")+"</ul>"]}):delete R.references,s&&s.temporal){var j=s.temporal.split("; ");if(j.length){var B=j.filter((function(e){return-1!==e.indexOf("scheme=")})).map((function(e){var t=e.indexOf("=");return e.substr(t+1,e.length-1)}));B=B.length?B[0]:"W3C-DTF";var P=j.filter((function(e){return-1!==e.indexOf("start=")||-1!==e.indexOf("end=")})).map((function(e){var t=e.indexOf("="),n=e.substr(0,t),i=e.substr(t+1,e.length-1),a=e.length-t-1<=10;return O()(["start","end"],n)&&"W3C-DTF"===B&&!a?(0,T.S$)(r,"catalog.".concat(n))+new Date(i).toLocaleString():O()(["start","end"],n)?(0,T.S$)(r,"catalog.".concat(n))+i:""}));R=q(q({},R),{},{temporal:["<ul>"+P.map((function(e){return"<li>".concat(e,"</li>")})).join("")+"</ul>"]})}}return{boundingBox:e.boundingBox,description:s&&c()(s.abstract)&&s.abstract||"",layerOptions:t&&t.layerOptions||{},identifier:s&&c()(s.identifier)&&s.identifier||"",references:w,thumbnail:n,title:s&&c()(s.title)&&s.title||"",tags:s&&s.tags||"",metadata:R}})):null},wms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e&&e.records?e.records.map((function(r){return{capabilities:r,credits:r.credits,boundingBox:E.ZP.getBBox(r),description:r.Abstract||r.Title||r.Name,identifier:r.Name,service:e.service,tags:"",layerOptions:q(q({},(null==t?void 0:t.layerOptions)||{}),(null==e?void 0:e.layerOptions)||{}),title:(0,P.EM)(r)||r.Name,formats:p()(r.formats||[]),dimensions:(r.Dimension&&p()(r.Dimension)||[]).map((function(e){return i()({},{values:e._&&e._.split(",")||[]},e.$||{})})).filter((function(e){return e&&"time"!==e.name})),references:[{type:"OGC:WMS",url:t&&t.url,SRS:r.SRS&&(l()(r.SRS)?r.SRS:[r.SRS])||[],params:{name:r.Name}}]}})):null},wmts:function(e,t){return e&&e.records?e.records.map((function(e){var r=p()(W.f1(e)||t&&t.url);1===r.length&&(r=r[0]);var n=W.dN(e),a=p()(e.TileMatrixSetLink||[]).reduce((function(t,r){var n,a=o()((e.TileMatrixSet&&p()(e.TileMatrixSet)||[]).filter((function(e){return e["ows:Identifier"]===r.TileMatrixSet}))),u=a&&j.default.getEPSGCode(a["ows:SupportedCRS"]),l=r.TileMatrixSetLimits&&(r.TileMatrixSetLimits.TileMatrixLimits||[]).map((function(e){return{identifier:e.TileMatrix,ranges:{cols:{min:e.MinTileCol,max:e.MaxTileCol},rows:{min:e.MinTileRow,max:e.MaxTileRow}}}}))||a.TileMatrix.map((function(e){return{identifier:e["ows:Identifier"]}}));return i()(t,(D(n={},a["ows:Identifier"],l),D(n,u,l),n))}),{}),u=function(e){var t=e["ows:WGS84BoundingBox"];return t||(t={"ows:LowerCorner":"-180.0 -90.0","ows:UpperCorner":"180.0 90.0"}),t}(e);return{title:A(e["ows:Title"]||e["ows:Identifier"]),description:A(e["ows:Abstract"]||e["ows:Title"]||e["ows:Identifier"]),identifier:A(e["ows:Identifier"]),tags:"",layerOptions:t&&t.layerOptions||{},style:e.style,capabilitiesURL:n,queryable:e.queryable,requestEncoding:e.requestEncoding,tileMatrixSet:e.TileMatrixSet,matrixIds:a,format:e.format,TileMatrixSetLink:p()(e.TileMatrixSetLink),boundingBox:{extent:[u["ows:LowerCorner"].split(" ")[0],u["ows:LowerCorner"].split(" ")[1],u["ows:UpperCorner"].split(" ")[0],u["ows:UpperCorner"].split(" ")[1]],crs:"EPSG:4326"},references:[{type:"OGC:WMTS",url:r,SRS:I(e.SRS||[],a),params:{name:e["ows:Identifier"]}}]}})):null},tms:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e&&e.records){var r=t.service&&"tms"===t.service.provider;return r?e.records.map((function(e){return{title:e.title,tileMapUrl:e.href,description:"".concat(e.srs).concat(e.format?", "+e.format:""),tmsUrl:t.tmsUrl,references:[{type:"OGC:TMS",version:"1.0.0",url:t.url}]}})):e.records.map((function(e){return{title:e.title||e.provider,url:e.url,attribution:e.attribution,options:e.options,provider:e.provider,type:"tileprovider",references:[]}}))}return null},wfs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.records;return t?t.map((function(e){return q(q({},e),{},{references:[{type:"OGC:WFS-1.1.0-http-get-capabilities",url:e.url},{type:"OGC:WFS-1.1.0-http-get-feature",url:e.url}]})})):null},backgrounds:function(e){return e&&e.records?e.records.map((function(e){return{description:e.title,title:e.title,identifier:e.name,thumbnail:e.thumbURL,references:[],background:e}})):null}},F=function(e){return e.filter((function(e){return j.default.isSRSAllowed(e)})).reduce((function(e,t){return i()(e,D({},t,!0))}),{})},$=function(e,t){var r=e.split("?"),n={};return r.length>=2&&r[1]&&r[1].split(/[&;]/g).forEach((function(e){var r=e.split("=");-1===t.indexOf(r[0].toLowerCase())&&(n[r[0]]=r[1])})),{url:r[0],params:n}},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.references,r=void 0===t?[]:t;return{wfs:o()(r.filter((function(e){return e.type&&("OGC:WFS"===e.type||e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-feature")>-1)}))),wms:o()(r.filter((function(e){return e.type&&("OGC:WMS"===e.type||e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-map")>-1)}))),wmts:o()(r.filter((function(e){return e.type&&("OGC:WMTS"===e.type||e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-map")>-1)}))),tms:o()(r.filter((function(e){return e.type&&("OGC:TMS"===e.type||e.type.indexOf("OGC:TMS")>-1)})))}},H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{references:[]};return{esri:o()(e.references.filter((function(e){return e.type&&("ESRI:SERVER"===e.type||"arcgis"===e.type)})))}},z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.references,r=void 0===t?[]:t,n=o()(r.filter((function(e){return e.type&&e.type.indexOf("OGC:WMS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),i=o()(r.filter((function(e){return e.type&&e.type.indexOf("OGC:WFS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),a=o()(r.filter((function(e){return e.type&&e.type.indexOf("OGC:WMTS")>-1&&e.type.indexOf("http-get-capabilities")>-1}))),u=[];return n&&u.push({type:"WMS_GET_CAPABILITIES",url:n.url,labelId:"catalog.wmsGetCapLink"}),a&&u.push({type:"WMTS_GET_CAPABILITIES",url:a.url,labelId:"catalog.wmtsGetCapLink"}),i&&u.push({type:"WFS_GET_CAPABILITIES",url:i.url,labelId:"catalog.wfsGetCapLink"}),u},Q=function(e){return e&&!l()(e)&&-1!==e.indexOf(",")?e.split(",").map((function(e){return e.trim()})):e},X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"wms",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.removeParams,i=void 0===n?[]:n,a=r.format,o=r.catalogURL,u=r.url,s=r.formats,c=void 0===s?{}:s,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},p=arguments.length>4?arguments[4]:void 0;if(!e||!e.references)return null;var d,m,g=Z(e),y=g.wms,b=g.wmts,v=y||b,h=function(e){return $(B.ZP.cleanDuplicatedQuestionMarks(e),["request","layer","layers","service","version"].concat(i))},O=Q(v.url);if(O&&l()(O))d=O.map((function(e){return h(e)})).map((function(e){return e.url})),m=O.map((function(e){return h(e)})).map((function(e){return e.params})).reduce((function(e,t){return q(q({},e),t)}),{});else{var x=h(O||o),S=x.url,w=x.params;d=S,m=w}var L=function(e){return l()(e)&&1===e.length?e[0]:e},M=L(u||d),j=F(v.SRS);return q(q(q({type:t,requestEncoding:e.requestEncoding,style:e.style,format:a,url:M,capabilitiesURL:e.capabilitiesURL,queryable:e.queryable,visibility:!0,dimensions:e.dimensions||[],name:v.params&&v.params.name,title:e.title||v.params&&v.params.name,matrixIds:"wmts"===t?e.matrixIds||[]:void 0,description:e.description||"",tileMatrixSet:"wmts"===t?e.tileMatrixSet||[]:void 0,credits:!B.ZP.getConfigProp("noCreditsFromCatalog")&&e.credits,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}},links:z(e),params:m,allowedSRS:j,catalogURL:o},f),e.layerOptions),{},{localizedLayerStyles:C()(p)?void 0:p},"wms"===t&&!R()(c)&&{imageFormats:c.imageFormats,infoFormats:c.infoFormats})},J=function(e,t,r,n){return U[e]&&U[e](t,r,n)||null},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||!e.references)return null;var r=H(e),n=r.esri;return q({type:n.type,url:n.url,visibility:!0,dimensions:e.dimensions||[],name:n.params&&n.params.name,bbox:{crs:e.boundingBox.crs,bounds:{minx:e.boundingBox.extent[0],miny:e.boundingBox.extent[1],maxx:e.boundingBox.extent[2],maxy:e.boundingBox.extent[3]}}},t)},V=[{label:"image/png",value:"image/png"},{label:"image/png8",value:"image/png8"},{label:"image/jpeg",value:"image/jpeg"},{label:"image/vnd.jpeg-png",value:"image/vnd.jpeg-png"},{label:"image/vnd.jpeg-png8",value:"image/vnd.jpeg-png8"},{label:"image/gif",value:"image/gif"}],Y=function(){return v()(Object.values((0,G.eq)()))},ee=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return E.ZP.getCapabilities(e).then((function(e){var r,n,i=S()(e,"capability.request.getMap.format",[]);if(R()(i))r=V;else{var a=V.map((function(e){return e.value}));r=(i=i.map((function(e){var t=e.value;return{label:t,value:t}}))).filter((function(e){var t=e.value;return O()(a,t)}))||[]}if(t){var o=S()(e,"capability.request.getFeatureInfo.format",[]),u=Y();R()(o)?n=u:(o=o.map((function(e){return e.value})),n=v()(o.filter((function(e){return O()(u,e)})))||[])}return t?{imageFormats:r,infoFormats:n}:r})).catch((function(){return t?{imageFormats:V,infoFormats:Y()}:V}))}}}]);